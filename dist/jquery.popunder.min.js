/* jquery-plugin to create popunders in major browsers., 0.2.17 https://github.com/hpbuniat/jquery-popunder
Copyright (c) 2014 Hans-Peter Buniat, BSD license https://github.com/hpbuniat/jquery-popunder/blob/master/LICENSE*/
!function(a,b,c,d,e){"use strict";a.popunder=function(c,d,e,f){var g=a.popunder.helper;if(0===arguments.length&&(c=b.aPopunder),e||d)g.bindEvents(c,d,e);else if(c="function"==typeof c?c(f):c,(g.ua.ie===!0||g.ua.g===!0)&&(c=g.handleTargetBlank(c,f)),g.reset(),"undefined"!=typeof c){do g.queue(c);while(c.length>0);g.ua.g&&"simple"!==!g.m.g||g.queue(c)}return a},a.popunder.helper={_top:b.self,lastWin:null,lastTarget:null,f:!1,last:!1,b:"about:blank",o:null,du:"__jqpu",ua:{ie:!!/msie/i.test(d.userAgent),ff:!!/firefox/i.test(d.userAgent),o:!!/opera/i.test(d.userAgent),g:!!/chrome/i.test(d.userAgent),w:!!/webkit/i.test(d.userAgent)},m:{g:"tab"},def:{window:{toolbar:0,scrollbars:1,location:1,statusbar:1,menubar:0,resizable:1,width:(c.availWidth-122).toString(),height:(c.availHeight-122).toString(),screenX:0,screenY:0,left:0,top:0},name:"__pu",cookie:"__puc",blocktime:!1,skip:{opera:!0,ipad:!0},cb:null,popup:!1},opt:{},uaTest:function(a){return!!new RegExp(a,"i").test(d.userAgent.toString())},queue:function(a){var b=!1,c=this;if(a.length>0)for(;b===!1;){var d=a.shift();b=d?c.open(d[0],d[1]||{},a.length):!0}else c.last===!1?(c.last=!0,c.bg().href(!0)):c.f||c.ua.g||c.bg();return c},bindEvents:function(b,c,d){var e=this,f="string",g=function(c){return a.popunder(b,!1,!1,c),!0};return c&&!e.ua.g&&(c=typeof c===f?a(c):c,c.on("submit",g)),d&&(d=typeof d===f?a(d):d,e.ua.g&&"simple"===e.m.g?e.iframe(d,g):d.on("click",g)),e},iframe:function(b,c){return b.each(function(){var b=a(this),d="absolute",e=b.css("position")===d?"":"position:relative;",f=b.wrap('<div class="jq-pu" style="display:inline-block; '+e+'" />').parent(),g={margin:0,padding:0,cursor:"pointer",width:b.outerWidth(),height:b.outerHeight()},h=a('<iframe scrolling="no" frameborder="0" src="about:blank"></iframe>').css(a.extend(!0,{},g,{position:d,top:e?0:b.css("top"),left:e?0:b.css("left"),padding:b.css("padding"),margin:b.css("margin"),width:b.width(),height:b.height()}));h.on("load",function(){a(this.contentDocument).on("mousedown mouseup",function(a){return function(b){c({target:a,type:b.type}),"mouseup"!==b.type&&a.trigger(b.type)}}(b)).find("html, body").css(g)}),f.append(h)}),this},cookieCheck:function(b){var c=this,d=c.rand(c.opt.cookie,!1),e=a.cookie(d),f=!1;return e?-1===e.indexOf(b)?e+=b:f=!0:e=b,a.cookie(d,e,{expires:new Date((new Date).getTime()+6e4*c.opt.blocktime)}),f},rand:function(a,b){var c=a?a:"pu";return c+(b===!1?"":Math.floor(89999999*Math.random()+1e7))},open:function(c,d,f){var g,h,i,j=this,k="function";if(h=a.extend(!0,{},j.def,d),i=h.skip,j.o=c,top!==b.self)try{top.document.location.toString()&&(j._top=top)}catch(l){}for(g in i)if(i.hasOwnProperty(g)&&i[g]===!0&&j.uaTest(g))return!1;return h.blocktime&&typeof a.cookie===k&&j.cookieCheck(c)?!1:(j.ua.g===!0&&"simple"!==j.ua.g&&b.open("javascript:window.focus()","_self",""),c!==j.du&&(j.lastTarget=c,j.ua.g===!0&&"flicker"===j.m.g&&e.documentElement.webkitRequestFullscreen(),j.ua.g===!0&&"tab"===j.m.g?j.switcher.tab(j,j.o):j.lastWin=j._top.window.open(j.o,j.rand(h.name,!d.name),j.getOptions(h.window))||j.lastWin,(j.ua.ff===!0||"simple"===j.m.g)&&j.bg(),j.href(f),typeof h.cb===k&&h.cb()),!0)},bg:function(a){var b=this;return b.lastWin&&b.lastTarget&&!a?b.ua.ie===!0?b.switcher.simple(b):b.ua.g===!0&&"flicker"===b.m.g?b.switcher.flicker(b):b.ua.g||b.switcher.pop(b):"simple"===b.m.g&&b.ua.g===!0&&b.switcher.simple(b),b},switcher:{simple:function(a){if(a.last===!0)try{b.name=(a.du+Math.random()+"").replace(".",""),b.open("",b.name)}catch(c){}else{try{a.lastWin.blur()}catch(c){}b.focus()}},pop:function(a){!function(b){try{a.f=b.window.open("about:blank"),a.f&&a.f.close()}catch(c){}try{b.opener.window.focus()}catch(c){}}(a.lastWin)},tab:function(c,d){var f=d?d:"data:text/html,<script>window.close();</script>;",g=!d,h=a("<a/>",{href:f}).appendTo(e.body),i=e.createEvent("MouseEvents");return g="tab"===c.m.g?!g:g,i.initMouseEvent("click",!0,!0,b,0,0,0,0,0,g,!1,!g,g,0,null),h[0].dispatchEvent(i),h[0].parentNode.removeChild(h[0]),c},flicker:function(a){return e.webkitCancelFullScreen(),setTimeout(function(){b.getSelection().empty()},250),a}},href:function(a){var b=this;if(a&&b.lastTarget&&b.lastWin&&b.lastTarget!==b.b&&b.lastTarget!==b.o)if(b.ua.g===!0&&"simple"!==b.m.g){var c=b.lastWin.document;c.open(),c.write("<html><head><title>"+e.title+'</title><script type="text/javascript">window.location="'+b.lastTarget+'";</script></head><body></body></html>'),c.close()}else b.lastWin.document.location.href=b.lastTarget;return b},handleTargetBlank:function(b,c){if(c&&"undefined"!=typeof c.target){var d,e=this,f=null,g=a(c.target);g.is('input[type="submit"]')===!0&&(f=c.target.form),f&&"_blank"===f.target&&(d=e.du,e.ua.ie&&(d=f.action+"/?"+a(f).serialize()),b.unshift([d,{popup:!0}]))}return b},reset:function(){var a=this;return a.f=a.last=!1,a.lastTarget=a.lastWin=null,a},getOptions:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b+"="+a[b]);return c.join(",")}}}(jQuery,window,screen,navigator,document);