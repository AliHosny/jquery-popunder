/* jquery-plugin to create popunders in major browsers., v0.2.2 https://github.com/hpbuniat/jquery-popunder
Copyright (c) 2013 Hans-Peter Buniat, BSD license https://github.com/hpbuniat/jquery-popunder/blob/master/LICENSE */
(function(a,b,c,d){"use strict",a.popunder=function(c,d,e,f){var g=a.popunder.helper;arguments.length===0&&(c=b.aPopunder);if(e||d)g.bindEvents(c,d,e);else{c=typeof c=="function"?c(f):c;if(typeof c!="undefined"){g.c=0;if(!g.ua.ie){do g.queue(c);while(c.length>0);g.queue(c)}else g.queue(c)}}return a},a.popunder.helper={_top:b.self,lastWin:null,lastTarget:null,f:!1,c:0,last:!1,b:"about:blank",o:null,ua:{ie:!!/msie/i.test(d.userAgent),o:!!/opera/i.test(d.userAgent),g:!!/chrome/i.test(d.userAgent),w:!!/webkit/i.test(d.userAgent)},def:{window:{toolbar:0,scrollbars:1,location:1,statusbar:1,menubar:0,resizable:1,width:(c.availWidth-122).toString(),height:(c.availHeight-122).toString(),screenX:0,screenY:0,left:0,top:0},name:"puWin",cookie:"puCookie",blocktime:!1,skip:{opera:!0,ipad:!0}},opt:{},uaTest:function(a){return!!(new RegExp(a,"i")).test(d.userAgent.toString())},queue:function(a){var b=!1,c=this;if(a.length>0)while(b===!1){var d=a.shift();b=d?c.open(d[0],d[1]||{},a.length):!0}else c.last===!1?(c.last=!0,c.bg().href(!0)):!c.f&&!c.ua.g&&c.bg();return c},bindEvents:function(b,c,d){var e=this,f=function(c){return a.popunder(b,!1,!1,c),!0};return c&&!e.ua.g&&(c=typeof c=="string"?a(c):c,c.on("submit",f)),d&&(d=typeof d=="string"?a(d):d,e.ua.g?e.iframe(d,f):d.on("click",f)),e},iframe:function(b,c){return b.each(function(){var b=a(this),d=b.css("position")==="absolute"?"":"position:relative;",e=b.wrap('<div style="display:inline-block; '+d+'" />').parent(),f=a('<iframe frameborder="0" src="about:blank"></iframe>').css({cursor:"pointer",position:"absolute",top:d?0:b.css("top"),left:d?0:b.css("left"),width:b.width(),padding:b.css("padding"),margin:b.css("margin"),height:b.height()});f.on("load",function(){a(this.contentDocument).on("click",function(a){return function(){c({target:a}),a.trigger("click")}}(b))}),e.append(f)}),this},cookieCheck:function(b){var c=this,d=c.rand(c.opt.cookie,!1),e=a.cookie(d),f=!1;return e?e.indexOf(b)===-1?e+=b:f=!0:e=b,a.cookie(d,e,{expires:new Date((new Date).getTime()+c.opt.blocktime*6e4)}),f},rand:function(a,b){var c=a?a:"pu";return c+(b===!1?"":Math.floor(89999999*Math.random()+1e7))},open:function(c,d,e){var f=this,g,h,i;h=a.extend(!0,{},f.def,d),i=h.skip,f.o=c;if(top!==b.self)try{top.document.location.toString()&&(f._top=top)}catch(j){}for(g in i)if(i.hasOwnProperty(g)&&i[g]===!0&&f.uaTest(g))return!1;return h.blocktime&&typeof a.cookie=="object"&&f.cookieCheck(c)?!1:(f.c++,f.lastTarget=c,f.o=f.ua.g?f.b:c,f.lastWin=f._top.window.open(f.o,f.rand(h.name,!d.name),f.getOptions(h.window))||f.lastWin,f.ua.g||f.bg(),f.href(e),!0)},bg:function(a){var c=this;return c.lastWin&&(this.lastTarget&&!a&&(c.ua.ie===!0?c.switcher.simple(c):c.switcher.pop(c)),c.lastWin.blur(),c._top.window.blur(),c._top.window.focus(),b.focus()),c},switcher:{simple:function(a){a.lastWin.blur(),b.focus();try{opener.window.focus()}catch(c){}},pop:function(a){(function(b){try{if(typeof b.window.mozPaintCount!="undefined"||typeof b.navigator.webkitGetUserMedia=="function")a.f=b.window.open("about:blank"),!a.f||a.f.close()}catch(c){}try{b.opener.window.focus()}catch(c){}})(a.lastWin)}},href:function(a){var b=this;return a&&b.lastTarget&&b.lastWin&&b.lastTarget!==b.b&&b.lastTarget!==b.o&&(b.lastWin.document.location.href=b.lastTarget),b},getOptions:function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c+"="+a[c]);return b.join(",")}}})(jQuery,window,screen,navigator);