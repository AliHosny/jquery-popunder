/* jquery-plugin to create popunders in major browsers., v0.2.5 https://github.com/hpbuniat/jquery-popunder
Copyright (c) 2013 Hans-Peter Buniat, BSD license https://github.com/hpbuniat/jquery-popunder/blob/master/LICENSE*/
(function(t,e,n,o,i){"use strict";t.popunder=function(n,o,i,r){var a=t.popunder.helper;if(0===arguments.length&&(n=e.aPopunder),i||o)a.bindEvents(n,o,i);else if(n="function"==typeof n?n(r):n,n!==void 0)if(a.c=0,a.ua.ie)a.queue(n);else{do a.queue(n);while(n.length>0);a.queue(n)}return t},t.popunder.helper={_top:e.self,lastWin:null,lastTarget:null,f:!1,c:0,last:!1,b:"about:blank",o:null,ua:{ie:!!/msie/i.test(o.userAgent),o:!!/opera/i.test(o.userAgent),g:!!/chrome/i.test(o.userAgent),w:!!/webkit/i.test(o.userAgent)},def:{window:{toolbar:0,scrollbars:1,location:1,statusbar:1,menubar:0,resizable:1,width:""+(n.availWidth-122),height:""+(n.availHeight-122),screenX:0,screenY:0,left:0,top:0},name:"__pu",cookie:"__puc",blocktime:!1,skip:{opera:!0,ipad:!0}},opt:{},uaTest:function(t){return!!RegExp(t,"i").test(""+o.userAgent)},queue:function(t){var e=!1,n=this;if(t.length>0)for(;e===!1;){var o=t.shift();e=o?n.open(o[0],o[1]||{},t.length):!0}else n.last===!1?(n.last=!0,n.bg().href(!0)):n.f||n.ua.g||n.bg();return n},bindEvents:function(e,n,o){var i=this,r=function(n){return t.popunder(e,!1,!1,n),!0};return n&&!i.ua.g&&(n="string"==typeof n?t(n):n,n.on("submit",r)),o&&(o="string"==typeof o?t(o):o,i.ua.g&&("function"==typeof e||e.length>1)?i.iframe(o,r):o.on("click",r)),i},iframe:function(e,n){return e.each(function(){var e=t(this),o="absolute"===e.css("position")?"":"position:relative;",i=e.wrap('<div class="jq-pu" style="display:inline-block; '+o+'" />').parent(),r=t('<iframe frameborder="0" src="about:blank"></iframe>').css({cursor:"pointer",position:"absolute",top:o?0:e.css("top"),left:o?0:e.css("left"),width:e.width(),padding:e.css("padding"),margin:e.css("margin"),height:e.height()});r.on("load",function(){t(this.contentDocument).on("click",function(t){return function(){n({target:t}),t.trigger("click")}}(e))}),i.append(r)}),this},cookieCheck:function(e){var n=this,o=n.rand(n.opt.cookie,!1),i=t.cookie(o),r=!1;return i?-1===i.indexOf(e)?i+=e:r=!0:i=e,t.cookie(o,i,{expires:new Date((new Date).getTime()+6e4*n.opt.blocktime)}),r},rand:function(t,e){var n=t?t:"pu";return n+(e===!1?"":Math.floor(89999999*Math.random()+1e7))},open:function(n,o,i){var r,a,s,u=this;if(a=t.extend(!0,{},u.def,o),s=a.skip,u.o=n,top!==e.self)try{""+top.document.location&&(u._top=top)}catch(c){}for(r in s)if(s.hasOwnProperty(r)&&s[r]===!0&&u.uaTest(r))return!1;return a.blocktime&&"function"==typeof t.cookie&&u.cookieCheck(n)?!1:(u.c++,u.lastTarget=n,u.o=u.ua.g?u.b:n,u.lastWin=u._top.window.open(u.o,u.rand(a.name,!o.name),u.getOptions(a.window))||u.lastWin,u.ua.g||u.bg(),u.href(i),!0)},bg:function(t){var n=this;return n.lastWin&&(n.lastWin.blur(),n._top.window.blur(),n._top.window.focus(),e.focus(),this.lastTarget&&!t&&(n.ua.ie===!0?n.switcher.simple(n):n.ua.g===!0?n.switcher.tab(n):n.switcher.pop(n))),n},switcher:{simple:function(t){t.lastWin.blur(),e.focus();try{opener.window.focus()}catch(n){}},pop:function(t){(function(e){try{(e.window.mozPaintCount!==void 0||"function"==typeof e.navigator.webkitGetUserMedia)&&(t.f=e.window.open("about:blank"),t.f&&t.f.close())}catch(n){}try{e.opener.window.focus()}catch(n){}})(t.lastWin)},tab:function(){var n="_tab",o="about:blank",r=t("<a/>",{href:o,target:"_tab"}).appendTo("body"),a=i.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,e,0,0,0,0,0,!0,!1,!1,!0,0,null),r[0].dispatchEvent(a),e.open(o,n).close()}},href:function(t){var e=this;return t&&e.lastTarget&&e.lastWin&&e.lastTarget!==e.b&&e.lastTarget!==e.o&&(e.lastWin.document.location.href=e.lastTarget),e},getOptions:function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e+"="+t[e]);return n.join(",")}}})(jQuery,window,screen,navigator,document);