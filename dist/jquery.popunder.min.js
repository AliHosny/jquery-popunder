/* jquery-plugin to create popunders in major browsers., v0.1 https://github.com/hpbuniat/jquery-popunder
Copyright (c) 2013 Hans-Peter Buniat, BSD license https://github.com/hpbuniat/jquery-popunder/blob/master/LICENSE */
(function(e,t,n,r){"use strict";e.popunder=function(n,r,i,s){var o=e.popunder.helper;return arguments.length===0&&(n=t.aPopunder),i||r?o.bindEvents(n,r,i):(n=typeof n=="function"?n(s):n,typeof n!="undefined"&&(o.c=0,o.queue(n))),e},e.popunder.helper={_top:t.self,lastWin:null,lastTarget:null,f:!1,c:0,last:!1,b:"about:blank",o:null,ua:{ie:!!/msie/i.test(r.userAgent),o:!!/opera/i.test(r.userAgent),w:!!/webkit/i.test(r.userAgent)},queue:function(e){var t=!1,n=this;if(e.length)while(t===!1){var r=e.shift();t=r?n.open(r[0],r[1]||{},e.length):!0}else n.last!==!1||!!n.ua.w&&n.c!==0?n.f||n.bg():(n.last=!0,n.bg().href(!0));return this},bindEvents:function(t,n,r){var i=function(n){var r=!0;return/mouse/.test(n.type)&&(n.stopPropagation(),n.preventDefault(),r=!1),e.popunder(t,!1,!1,n),r};n&&(n=typeof n=="string"?e(n):n,n.on("submit",i)),r&&(r=typeof r=="string"?e(r):r,r.on(this.ua.w===!0?"mousedown click":"click",i))},cookieCheck:function(t,n){var r=this.rand(n.cookie,!1),i=e.cookie(r),s=!1;return i?i.indexOf(t)===-1?i+=t:s=!0:i=t,e.cookie(r,i,{expires:new Date((new Date).getTime()+n.blocktime*36e5)}),s},rand:function(e,t){var n=e?e:"pu";return n+(t===!1?"":Math.floor(89999999*Math.random()+1e7))},open:function(n,r,i){var s=this;s.o=n;if(top!==t.self)try{top.document.location.toString()&&(s._top=top)}catch(o){}return r.disableOpera=r.disableOpera||!0,r.disableOpera===!0&&s.ua.o===!0?!1:(r.blocktime=r.blocktime||!1,r.cookie=r.cookie||"puCookie",r.blocktime&&typeof e.cookie=="object"&&s.cookieCheck(n,r)?!1:(s.c++,s.lastTarget=n,s.o=s.ua.w?s.b:n,s.lastWin=s._top.window.open(s.o,s.rand(r.name,!r.name),s.getOptions(r))||s.lastWin,s.ua.w||s.bg(),s.href(i),!0))},bg:function(e){var n=this;if(n.lastWin){n.lastWin.blur(),n._top.window.blur(),n._top.window.focus();if(this.lastTarget&&!e)if(n.ua.ie===!0){t.focus();try{opener.window.focus()}catch(r){}}else(function(e){n.flip(e);try{e.opener.window.focus()}catch(t){}})(n.lastWin)}return this},href:function(e){var t=this;return e&&t.lastTarget&&t.lastWin&&t.lastTarget!==t.b&&t.lastTarget!==t.o&&(t.lastWin.document.location.href=t.lastTarget),t},flip:function(e){try{var t=this;if(typeof e.window.mozPaintCount!="undefined"||typeof e.navigator.webkitGetUserMedia=="function")t.f=e.window.open("about:blank"),t.f&&t.f.close()}catch(n){}},getOptions:function(e){return"toolbar="+(e.toolbar||"0")+",scrollbars="+(e.scrollbars||"1")+",location="+(e.location||"1")+",statusbar="+(e.statusbar||"1")+",menubar="+(e.menubar||"0")+",resizable="+(e.resizable||"1")+",width="+(e.width||(n.availWidth-122).toString())+",height="+(e.height||(n.availHeight-122).toString())+",screenX="+(e.screenX||"0")+",screenY="+(e.screenY||"0")+",left="+(e.left||"0")+",top="+(e.top||"0")}}})(jQuery,window,screen,navigator);