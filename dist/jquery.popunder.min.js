/* jquery-plugin to create popunders in major browsers., v0.2 https://github.com/hpbuniat/jquery-popunder
Copyright (c) 2013 Hans-Peter Buniat, BSD license https://github.com/hpbuniat/jquery-popunder/blob/master/LICENSE */
(function(e,t,n,r){"use strict";e.popunder=function(n,r,i,s){var o=e.popunder.helper;arguments.length===0&&(n=t.aPopunder);if(i||r)o.bindEvents(n,r,i);else{n=typeof n=="function"?n(s):n;if(typeof n!="undefined"){o.c=0;if(!o.ua.ie){do o.queue(n);while(n.length>0);o.queue(n)}else o.queue(n)}}return e},e.popunder.helper={_top:t.self,lastWin:null,lastTarget:null,f:!1,c:0,last:!1,b:"about:blank",o:null,ua:{ie:!!/msie/i.test(r.userAgent),o:!!/opera/i.test(r.userAgent),g:!!/chrome/i.test(r.userAgent),w:!!/webkit/i.test(r.userAgent)},def:{window:{toolbar:0,scrollbars:1,statusbar:1,menubar:0,resizable:1,width:(n.availWidth-122).toString(),height:(n.availHeight-122).toString(),screenX:0,screenY:0,left:0,top:0},name:"puWin",cookie:"puCookie",blocktime:!1,skip:{opera:!0,ipad:!0}},opt:{},uaTest:function(e){return!!(new RegExp(e,"i")).test(r.userAgent.toString())},queue:function(e){var t=!1,n=this;if(e.length>0)while(t===!1){var r=e.shift();t=r?n.open(r[0],r[1]||{},e.length):!0}else n.last===!1?(n.last=!0,n.bg().href(!0)):!n.f&&!n.ua.g&&n.bg();return n},bindEvents:function(t,n,r){var i=this,s=function(n){return e.popunder(t,!1,!1,n),!0};return n&&!i.ua.g&&(n=typeof n=="string"?e(n):n,n.on("submit",s)),r&&(r=typeof r=="string"?e(r):r,i.ua.g?i.iframe(r,s):r.on("click mousedown",s)),i},iframe:function(t,n){return t.each(function(){var t=e(this),r=t.wrap('<div style="display:inline-block; position:relative;" />').parent(),i=e('<iframe frameborder="0" src="about:blank"></iframe>').css({cursor:"pointer",position:"absolute",top:0,left:0,width:t.width(),padding:t.css("padding"),margin:t.css("margin"),height:t.height()});i.on("load",function(){e(this.contentDocument).on("click",function(e){return function(){n({target:e}),e.trigger("click")}}(t))}),r.append(i)}),this},cookieCheck:function(t){var n=this,r=n.rand(n.opt.cookie,!1),i=e.cookie(r),s=!1;return i?i.indexOf(t)===-1?i+=t:s=!0:i=t,e.cookie(r,i,{expires:new Date((new Date).getTime()+n.opt.blocktime*6e4)}),s},rand:function(e,t){var n=e?e:"pu";return n+(t===!1?"":Math.floor(89999999*Math.random()+1e7))},open:function(n,r,i){var s=this,o,u,a;u=e.extend(!0,{},s.def,r),a=u.skip,s.o=n;if(top!==t.self)try{top.document.location.toString()&&(s._top=top)}catch(f){}for(o in a)if(a.hasOwnProperty(o)&&a[o]===!0&&s.uaTest(o))return!1;return u.blocktime&&typeof e.cookie=="object"&&s.cookieCheck(n)?!1:(s.c++,s.lastTarget=n,s.o=s.ua.g?s.b:n,s.lastWin=s._top.window.open(s.o,s.rand(u.name,!r.name),s.getOptions(u.window))||s.lastWin,s.ua.g||s.bg(),s.href(i),!0)},bg:function(e){var n=this;return n.lastWin&&(this.lastTarget&&!e&&(n.ua.ie===!0?n.switcher.simple(n):n.switcher.pop(n)),n.lastWin.blur(),n._top.window.blur(),n._top.window.focus(),t.focus()),n},switcher:{simple:function(e){e.lastWin.blur(),t.focus();try{opener.window.focus()}catch(n){}},pop:function(e){(function(t){try{if(typeof t.window.mozPaintCount!="undefined"||typeof t.navigator.webkitGetUserMedia=="function")e.f=t.window.open("about:blank"),!e.f||e.f.close()}catch(n){}try{t.opener.window.focus()}catch(n){}})(e.lastWin)}},href:function(e){var t=this;return e&&t.lastTarget&&t.lastWin&&t.lastTarget!==t.b&&t.lastTarget!==t.o&&(t.lastWin.document.location.href=t.lastTarget),t},getOptions:function(e){var t=[],n;for(n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return t.join(",")}}})(jQuery,window,screen,navigator);