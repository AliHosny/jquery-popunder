/* jquery-plugin to create popunders in major browsers., dev-master https://github.com/hpbuniat/jquery-popunder
Copyright (c) 2013 Hans-Peter Buniat, BSD license https://github.com/hpbuniat/jquery-popunder/blob/master/LICENSE*/
!function(a,b,c,d,e){"use strict";a.popunder=function(c,d,e,f){var g=a.popunder.helper;if(0===arguments.length&&(c=b.aPopunder),e||d)g.bindEvents(c,d,e);else if(c="function"==typeof c?c(f):c,(g.ua.ie===!0||g.ua.g===!0)&&(c=g.handleTargetBlank(c,f)),"undefined"!=typeof c){g.c=0;do g.queue(c);while(c.length>0&&!g.ua.ie);g.ua.ie||g.queue(c)}return a},a.popunder.helper={_top:b.self,lastWin:null,lastTarget:null,f:!1,c:0,last:!1,b:"about:blank",o:null,du:"__dummy",ua:{ie:!!/msie/i.test(d.userAgent),ff:!!/firefox/i.test(d.userAgent),o:!!/opera/i.test(d.userAgent),g:!!/chrome/i.test(d.userAgent),w:!!/webkit/i.test(d.userAgent)},def:{window:{toolbar:0,scrollbars:1,location:1,status:1,menubar:0,resizable:1,width:(c.availWidth-122).toString(),height:(c.availHeight-122).toString(),screenX:0,screenY:0,left:0,top:0},name:"__pu",cookie:"__puc",blocktime:!1,skip:{opera:!0,ipad:!0},cb:null},opt:{},uaTest:function(a){return!!new RegExp(a,"i").test(d.userAgent.toString())},queue:function(a){var b=!1,c=this;if(a.length>0)for(;b===!1;){var d=a.shift();b=d?c.open(d[0],d[1]||{},a.length):!0}else c.last===!1?(c.last=!0,c.bg().href(!0)):c.f||c.ua.g||c.bg();return c},bindEvents:function(b,c,d){var e=this,f="string",g=function(c){return a.popunder(b,!1,!1,c),!0};return c&&!e.ua.g&&(c=typeof c===f?a(c):c,c.on("submit",g)),d&&(d=typeof d===f?a(d):d,d.on("click mousedown",g)),e},cookieCheck:function(b){var c=this,d=c.rand(c.opt.cookie,!1),e=a.cookie(d),f=!1;return e?-1===e.indexOf(b)?e+=b:f=!0:e=b,a.cookie(d,e,{expires:new Date((new Date).getTime()+6e4*c.opt.blocktime)}),f},rand:function(a,b){var c=a?a:"pu";return c+(b===!1?"":Math.floor(89999999*Math.random()+1e7))},open:function(c,d,e){var f,g,h,i=this,j="function";if(g=a.extend(!0,{},i.def,d),h=g.skip,i.o=c,top!==b.self)try{top.document.location.toString()&&(i._top=top)}catch(k){}for(f in h)if(h.hasOwnProperty(f)&&h[f]===!0&&i.uaTest(f))return!1;return g.blocktime&&typeof a.cookie===j&&i.cookieCheck(c)?!1:(i.c++,b.open("javascript:window.focus()","_self",""),c!==i.du&&(i.lastTarget=c,i.o=i.ua.g?i.b:c,i.lastWin=i._top.window.open(i.o,i.rand(g.name,!d.name),i.getOptions(g.window))||i.lastWin,i.ua.ff&&i.bg(),i.href(e),typeof g.cb===j&&g.cb()),!0)},bg:function(a){var c=this;return c.lastWin&&(c.lastWin.blur(),c._top.window.blur(),c._top.window.focus(),b.focus(),c.lastTarget&&!a&&(c.ua.ie===!0?c.switcher.simple(c):c.ua.g===!0?c.switcher.tab(c):c.switcher.pop(c))),c},switcher:{simple:function(a){a.lastWin.blur(),b.focus();try{opener.window.focus()}catch(c){}},pop:function(a){!function(b){try{("undefined"!=typeof b.window.mozPaintCount||"function"==typeof b.navigator.webkitGetUserMedia)&&(a.f=b.window.open("about:blank"),a.f&&a.f.close())}catch(c){}try{b.opener.window.focus()}catch(c){}}(a.lastWin)},tab:function(){var c="_tab",d="about:blank",f=a("<a/>",{href:d,target:c}).appendTo("body"),g=e.createEvent("MouseEvents");g.initMouseEvent("click",!0,!0,b,0,0,0,0,0,!0,!1,!1,!0,0,null),f[0].dispatchEvent(g),b.open(d,c).close()}},href:function(a){var b=this;if(a&&b.lastTarget&&b.lastWin&&b.lastTarget!==b.b&&b.lastTarget!==b.o)if(b.ua.g===!0){var c=b.lastWin.document;c.open(),c.write("<html><head><title>"+e.title+'</title><script type="text/javascript">window.location="'+b.lastTarget+'";</script></head><body></body></html>'),c.close()}else b.lastWin.document.location.href=b.lastTarget;return b},handleTargetBlank:function(b,c){if(c&&"undefined"!=typeof c.target){var d,e=this,f=null,g=a(c.target);g.is('input[type="submit"]')===!0&&(f=c.target.form),f&&"_blank"===f.target&&(d=e.du,e.ua.ie&&(d=f.action+a(f).serialize()),b.push([d]))}return b},getOptions:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b+"="+a[b]);return c.join(",")}}}(jQuery,window,screen,navigator,document);